[tox]
envlist = py3,locust

[flake8]
exclude =
        .tox,
        __pycache__,
        ./docs/*
        ,build,
        dist,
        notebooks,
        migrations,
        snomedct_terminology_server/server/views/__init__.py,
        snomedct_terminology_server/server/docs.py,
        snomedct_terminology_server/server/expressions/grammars/ECLPortLexer.py,
        snomedct_terminology_server/server/expressions/grammars/ECLPortParser.py,
        snomedct_terminology_server/server/expressions/grammars/ECLPortListener.py,
        snomedct_terminology_server/server/expressions/grammars/TestECLPortListener.py,
        snomedct_terminology_server/server/expressions/grammars/test_ecl_port.py,
        snomedct_terminology_server/server/expressions/grammars/CompositionalGrammarLexer.py,
        snomedct_terminology_server/server/expressions/grammars/CompositionalGrammarParser.py,
        snomedct_terminology_server/server/expressions/grammars/CompositionalGrammarListener.py,
        snomedct_terminology_server/server/expressions/grammars/TestCompositionalGrammarListener.py,
        snomedct_terminology_server/server/expressions/grammars/expressions.py,
        snomedct_terminology_server/server/expressions/grammars/CompositionalExpressions.py,
        snomedct_terminology_server/server/expressions/grammars/CompositionalGrammarScope.py,
        snomedct_terminology_server/server/expressions/grammars/CompositionalGrammarScope.py,
        snomedct_terminology_server/server/expressions/grammars/SymbolScope.py
max_line_length = 100

[testenv:py3]
DJANGO_SETTINGS_MODULE=snomedct_terminology_server.config.test_settings
basepython=python3
passenv =
    DATABASE_URL
    ADJACENCY_LIST_FILE
    ISO_639_CODES
    API_ROOT_ENDPOINT
setenv =
    PYTHONPATH = .
    DEBUG_EXPRESSIONS = false
deps =
  -rrequirements-test.txt

commands =
         python setup.py check
         flake8
         coverage erase
         coverage run --branch snomedct_terminology_server/manage.py test --settings=snomedct_terminology_server.config.test_settings
         coverage report
         coverage html

[testenv:locust]
setenv =
    PYTHONPATH = .
deps =
  locustio

basepython=python2
commands =
         locust -f snomedct_terminology_server/server/tests/locustfile.py --host {env:API_ROOT_ENDPOINT:}
