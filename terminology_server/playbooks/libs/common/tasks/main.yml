---
- name: Update packages
  apt: update_cache=yes
  become_user: root
  tags: common

- name: Set localtime to Africa/Nairobi
  file: state=link src=/usr/share/zoneinfo/Africa/Nairobi dest=/etc/localtime
  tags: common
  become_user: root

- name: Install build-essentials
  apt: name=build-essential state=present
  become_user: root
  tags: common


- name: Install htop, tmux
  apt: name={{ item }} state=present
  become_user: root
  with_items:
    - tmux
    - htop
  tags: common

- name: Install text editors
  apt: name={{ item }} state=present
  become_user: root
  with_items:
    - nano
    - vim
  tags: common


- name: Overwrite default tmux config and issue files
  template: src={{item.src}} dest={{item.dest}}
  become_user: root
  tags: common
  with_items:
    - {src: tmux.conf, dest: /etc/tmux.conf}
    - {src: issue, dest: /etc/issue}


- name: Add common deploy group
  group: name={{deploy_group}} state=present
  become_user: root
  tags: common


- name: Add the ansible and root user to the deploy group
  user: name={{item}} groups={{deploy_group}} append=yes
  become_user: root
  tags: common
  with_items:
      - "{{ansible_ssh_user}}"
      - root
      - "{{deploy_user}}"

- name: Copy swap space script
  copy: >-
    src=libs/common/templates/swap.sh dest=/swap.sh owner=root group={{deploy_group}} mode="u=rwx,g=rwx"
  become_user: root
  tags: common, swap_space

- name: mkswap and turn on swap
  command: >-
    bash /swap.sh
  become_user: root
  tags: common, swap_space

- name: add allocated swapfile to fstab
  lineinfile: dest=/etc/fstab line="/allocated_swapfile          swap            swap    defaults        0 0"
  become_user: root
  tags: common, swap_space